#!/bin/sh

ostype=`uname`
shell=bash

case $ostype in

#	NetBSD)
#		echo "This is a NetBSD system; just run make"
#		exit 0
#		;;

	FreeBSD)
		echo "This is a FreeBSD system; just run make"
		exit 0
		;;

	SunOS)
		;;

	Linux)
		;;
esac

# Test for existance of useable shell
echo -n Checking for $shell...
x=`which $shell`
if [ ! -x $x ]; then
	echo shell $shell is missing or not in path. please fix.
	exit 1
fi
shell=$x
echo $shell

# Check for spcgen
echo -n Checking for spcgen...
x=`which spcgen`
if [ ! -x $x ]; then
	echo spcgen is missing or not in path, please fetch and install it.
	echo ftp://subzero.campus.luth.se/pub/spcgen/spcgen-1.1.tar.gz
	exit 1
fi
echo $x

# Make makefiles
echo -n Creating makefiles...
(cd backend; $shell ../support/mklibmake < Makefile > Makefile.autogen)
(cd rkom; $shell ../support/mkprogmake < Makefile > Makefile.autogen)

cat > Makefile.autogen << EOF
# Autogenerated makefile, do not edit
#

all:
	(cd backend; make -f Makefile.autogen)
	(cd rkom; make -f Makefile.autogen)

clean:
	(cd backend; make -f Makefile.autogen clean)
	(cd rkom; make -f Makefile.autogen clean)
	
EOF
echo Ok.

echo
echo Now type \"make -f Makefile.autogen\".
echo
